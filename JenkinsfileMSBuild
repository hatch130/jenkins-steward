pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                build job: 'steward-ms-build', parameters: [string(name: 'TAG', value: params.TAG)]
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
        stage('Switch Microservices Base Stage') {
            steps {
                build job: 'change-environment-tag', parameters: [string(name: 'ACQUIATAG', value: params.TAG), string(name: 'ACQUIAAPP', value: 'stewardcommunity'), string(name: 'ACQUIAENV', value: 'test')]
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
        stage('Wait five minutes because the switch job tells us that we switched even if it will still take some time') {
            steps {
                build job: 'wait-n-seconds', parameters: [string(name: 'SECONDS', value: '300')]
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
        stage('Update Stage MS') {
            steps {
                build job: 'update-ms-stage-mstest'
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
        stage('Update Stage Events') {
            steps {
                build job: 'update-events-stage-mstest'
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
        stage('Update Stage Feed') {
            steps {
                build job: 'update-feed-stage-mstest'
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
        stage('Update Stage ER wait') {
            steps {
                build job: 'update-erwait-stage-mstest'
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
        stage('Update Stage Doctors') {
            steps {
                build job: 'update-doctors-stage-mstest'
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
        stage('Update Stage Forms') {
            steps {
                build job: 'update-forms-stage-mstest'
            }
            post{
                failure {
                    script{
                        error "Failed, exiting now..."
                    }
                }
                unstable {
                    script{
                        error "Unstable, exiting now..."
                    }
                }
            }
        }
    }
}
